// Generated by CoffeeScript 1.10.0

/**
 * PaymentController
 *
 * @description :: Server-side logic for managing Payments
 * @help        :: See http://sailsjs.org/#!/documentation/concepts/Controllers
 */
var passport;

passport = require('passport');

module.exports = {
  create_payment: function(req, res) {
    var stripe;
    sails.log.debug("Hit the Payment controller/create_payment");
    sails.log.debug("Create payment params " + (JSON.stringify(req.body)));
    stripe = require("stripe")(sails.config.stripe.stripe_secret);
    return stripe.customers.create({
      description: 'Customer for test@example.com',
      source: req.body.stripe_token
    }).then(function(customer) {
      sails.log.debug("Customer " + (JSON.stringify(customer)));
      return User.update(req.body.user_id, {
        stripe_id: customer.id
      }).exec(function(err, updated) {
        if (err != null) {
          sails.log.debug("User stripe customer create update error " + (JSON.stringify(err)));
        }
        return sails.log.debug("User stripe customer create update " + (JSON.stringify(updated)));
      });
    });
  }
};
