// Generated by CoffeeScript 1.10.0

/**
 * UserController
 *
 * @description :: Server-side logic for managing Business
 * @help        :: See http://sailsjs.org/#!/documentation/concepts/Controllers
 */
var passport;

passport = require('passport');

module.exports = {
  create_business: function(req, res) {
    var business_data;
    sails.log.debug("Hit the business controller &&&&&&&&&&&&&&&&&&&&&&&&&&&");
    sails.log.debug("Data " + (JSON.stringify(req.body)));
    business_data = req.body;
    return Org.create({
      name: business_data.name,
      address: business_data.address,
      admin: business_data.user_id
    }).then(function(org) {
      return sails.log.debug("Org create THEN " + (JSON.stringify(org)));
    })["catch"](function(err) {
      return sails.log.debug("Org create catch " + (JSON.stringify(err)));
    }).done(function(e) {
      sails.log.debug("Org create done " + (JSON.stringify(e)));
      return User.findOne({
        id: business_data.user_id
      }).populate('orgs').exec(function(err, users_orgs) {
        sails.log.debug("user find populate " + (JSON.stringify(users_orgs)));
        sails.log.debug("user find populate error " + (JSON.stringify(err)));
        return res.send(users_orgs.orgs);
      });
    });
  },
  destroy_business: function(req, res) {
    return Org.destroy({
      id: req.body.org_id
    }).exec(function(err) {
      sails.log.debug('The record has been deleted ' + JSON.stringify(err));
    });
  }
};
