{"version":3,"sources":["controllers/OrgController.coffee"],"names":[],"mappings":"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","file":"controllers/OrgController.js","sourceRoot":"/source/","sourcesContent":["'use strict'\r\n\r\nangular.module('subzapp').controller('OrgController', [\r\n  '$scope'\r\n  '$state'\r\n  '$http'\r\n  '$window'\r\n  '$location'\r\n  'user'\r\n  'RESOURCES'\r\n  'alertify'\r\n  'usSpinnerService'\r\n  ( $scope, $state, $http, $window, $location, user, RESOURCES, alertify, usSpinnerService ) ->\r\n    user_token = window.localStorage.getItem 'user_token'\r\n\r\n    get_orgs = ->\r\n      $http(\r\n        method: 'GET'\r\n        url: \"#{ RESOURCES.DOMAIN }/orgs\"\r\n        headers: { \r\n                  'Authorization': \"JWT #{ user_token }\", \"Content-Type\": \"application/json\"\r\n                  }\r\n      ).then( ( orgs ) ->\r\n        console.log \"Got orgs \"\r\n        console.log orgs.data\r\n        $scope.orgs = orgs.data\r\n      ).catch( ( err ) ->\r\n        console.log \"Got orgs error\"\r\n        console.log err\r\n        if err.status == 401\r\n          alertify.error \"You are not authorised to view this page\"\r\n          $state.go 'login'\r\n      )\r\n        \r\n\r\n    console.log 'Org Controller'\r\n    if !(window.USER?)\r\n      user.get_user().then ( (res) ->\r\n        get_orgs()\r\n\r\n      ), ( errResponse ) ->\r\n        console.log \"User get error #{ JSON.stringify errResponse }\"\r\n        window.USER = null\r\n        $state.go 'login'\r\n    else\r\n      get_orgs()\r\n      console.log \"USER already defined\"\r\n      \r\n      \r\n    $scope.get_org_info = ( id ) ->\r\n      usSpinnerService.spin('spinner-1')\r\n      console.log $scope.org\r\n      $http(\r\n        method: 'GET'\r\n        url: \"#{ RESOURCES.DOMAIN }/org/s3-info/#{ $scope.org }\"\r\n        headers: { \r\n                  'Authorization': \"JWT #{ user_token }\", \"Content-Type\": \"application/json\"\r\n                  }\r\n\r\n      ).then ( ( res ) ->\r\n        usSpinnerService.stop('spinner-1')\r\n        console.log \"s3_info response\"\r\n        console.log res.data\r\n        $scope.files = res.data.Contents\r\n      ), ( errResponse ) ->\r\n        usSpinnerService.stop('spinner-1')\r\n        console.log \"s3_info error response\"\r\n        console.log err\r\n        if err.status == 401\r\n          alertify.error \"You are not authorised to view this page\"\r\n          $state.go 'login'\r\n      \r\n\r\n    $scope.parse_users = ->\r\n      console.log 'yep'\r\n      $http(\r\n        method: 'POST'\r\n        url: \"#{ RESOURCES.DOMAIN }/file/parse-players\"\r\n        headers: { \r\n                  'Authorization': \"JWT #{ user_token }\", \"Content-Type\": \"application/json\"\r\n                  }\r\n        data:\r\n          org_id: 1\r\n      ).then ( ( res ) ->\r\n        console.log \"parse users response\"\r\n        console.log res\r\n        $scope.parsed_data = res\r\n      ), ( errResponse ) ->\r\n        console.log \"Parse users error\"\r\n        console.log errResponse\r\n\r\n])\r\n\r\n\r\n"]}