{"version":3,"sources":["controllers/RegisterManagerController.coffee"],"names":[],"mappings":"AAAA;AAEA,OAAO,CAAC,MAAR,CAAe,SAAf,CAAyB,CAAC,UAA1B,CAAqC,2BAArC,EAAkE;EAChE,QADgE,EAEhE,QAFgE,EAGhE,OAHgE,EAIhE,SAJgE,EAKhE,UALgE,EAMhE,WANgE,EAOhE,WAPgE,EAQhE,OARgE,EAShE,SAAE,MAAF,EAAU,MAAV,EAAkB,KAAlB,EAAyB,OAAzB,EAAkC,QAAlC,EAA4C,SAA5C,EAAuD,SAAvD,EAAkE,KAAlE;IACE,OAAO,CAAC,GAAR,CAAY,6BAAZ;IACA,MAAM,CAAC,0BAAP,GAAoC,SAAS,CAAC,MAAV,CAAA;IAEpC,OAAO,CAAC,GAAR,CAAY,SAAS,CAAC,MAAV,CAAA,CAAZ;IAEA,KAAA,CACE;MAAA,MAAA,EAAQ,KAAR;MACA,GAAA,EAAS,SAAS,CAAC,MAAZ,GAAoB,aAD3B;MAEA,OAAA,EAAS;QACG,cAAA,EAAgB,kBADnB;OAFT;MAKA,MAAA,EACE;QAAA,SAAA,EAAW,SAAS,CAAC,MAAV,CAAA,CAAkB,CAAC,EAA9B;OANF;KADF,CAQC,CAAC,IARF,CAQO,CAAE,SAAE,QAAF;MACP,OAAO,CAAC,GAAR,CAAY,qBAAZ;MACA,OAAO,CAAC,GAAR,CAAY,QAAQ,CAAC,IAArB;MACA,MAAM,CAAC,YAAY,CAAC,OAApB,CAA4B,SAA5B,EAAuC,QAAQ,CAAC,IAAI,CAAC,OAArD;MACA,MAAM,CAAC,0BAAP,GAAoC,QAAQ,CAAC;MAC7C,MAAM,CAAC,0BAA0B,CAAC,aAAlC,GAAkD,QAAQ,CAAC,IAAI,CAAC;aAChE,MAAM,CAAC,OAAP,GAAiB,QAAQ,CAAC,IAAI,CAAC;IANxB,CAAF,CARP,EAgBG,SAAE,WAAF;MACD,OAAO,CAAC,GAAR,CAAY,kBAAZ;aACA,OAAO,CAAC,GAAR,CAAY,WAAZ;IAFC,CAhBH;WAoBA,MAAM,CAAC,uBAAP,GAAiC,SAAA;MAC/B,OAAO,CAAC,GAAR,CAAY,IAAI,CAAC,SAAL,CAAe,MAAM,CAAC,0BAAtB,CAAZ;MACA,MAAM,CAAC,0BAA0B,CAAC,UAAlC,GAA+C;MAC/C,MAAM,CAAC,0BAA0B,CAAC,OAAlC,GAA4C,MAAM,CAAC;MACnD,MAAM,CAAC,0BAA0B,CAAC,KAAlC,GAA0C,MAAM,CAAC,0BAA0B,CAAC;MAC5E,OAAO,MAAM,CAAC,0BAA0B,CAAC;MAEzC,OAAO,CAAC,GAAR,CAAY,MAAM,CAAC,0BAAnB;aACA,KAAK,CAAC,IAAN,CACE,2BADF,EAEE,MAAM,CAAC,0BAFT,CAGC,CAAC,IAHF,CAGO,CAAE,SAAC,QAAD;QACP,OAAO,CAAC,GAAR,CAAY,2BAAZ;QACA,OAAO,CAAC,GAAR,CAAY,QAAZ;QACA,MAAM,CAAC,YAAY,CAAC,OAApB,CAA4B,YAA5B,EAA0C,QAAQ,CAAC,IAAI,CAAC,KAAxD;QAEA,MAAM,CAAC,YAAY,CAAC,OAApB,CAA4B,SAA5B,EAAuC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,EAA1D;eACA,MAAM,CAAC,EAAP,CAAU,cAAV;MANO,CAAF,CAHP,EAUG,SAAE,WAAF;QACD,OAAO,CAAC,GAAR,CAAY,sBAAZ;QACA,QAAQ,CAAC,KAAT,CAAe,sBAAA,GAAsB,CAAE,IAAI,CAAC,SAAL,CAAe,WAAf,CAAF,CAArC;QACA,UAAA,CAAW,CAAE,SAAA;iBACX,MAAM,CAAC,EAAP,CAAU,OAAV;QADW,CAAF,CAAX,EAEG,IAFH;eAGA,OAAO,CAAC,GAAR,CAAY,WAAZ;MANC,CAVH;IAR+B;EA1BnC,CATgE;CAAlE","file":"controllers/RegisterManagerController.js","sourceRoot":"/source/","sourcesContent":["'use strict'\r\n\r\nangular.module('subzapp').controller('RegisterManagerController', [\r\n  '$scope'\r\n  '$state'\r\n  '$http'\r\n  '$window'\r\n  'alertify'\r\n  '$location'\r\n  'RESOURCES'\r\n  'COMMS'\r\n  ( $scope, $state, $http, $window, alertify, $location, RESOURCES, COMMS ) ->\r\n    console.log 'Register Manager Controller'\r\n    $scope.register_manager_form_data = $location.search()\r\n\r\n    console.log $location.search()\r\n\r\n    $http(\r\n      method: 'GET'\r\n      url: \"#{ RESOURCES.DOMAIN }/get-invite\"\r\n      headers: { \r\n                  'Content-Type': 'application/json'\r\n                }\r\n      params:\r\n        invite_id: $location.search().id\r\n    ).then ( ( response ) ->\r\n      console.log \"Get invite response\"\r\n      console.log response.data\r\n      window.localStorage.setItem 'team_id', response.data.team_id\r\n      $scope.register_manager_form_data = response.data\r\n      $scope.register_manager_form_data.invited_email = response.data.invited_email\r\n      $scope.team_id = response.data.team_id\r\n\r\n    ), ( errResponse ) ->\r\n      console.log \"Get invite error\"\r\n      console.log errResponse\r\n\r\n    $scope.register_manager_submit = ->\r\n      console.log JSON.stringify $scope.register_manager_form_data\r\n      $scope.register_manager_form_data.team_admin = true\r\n      $scope.register_manager_form_data.team_id = $scope.team_id\r\n      $scope.register_manager_form_data.email = $scope.register_manager_form_data.invited_email\r\n      delete $scope.register_manager_form_data.invited_email\r\n      \r\n      console.log $scope.register_manager_form_data\r\n      COMMS.POST(\r\n        \"/auth/signup/team_manager\"\r\n        $scope.register_manager_form_data\r\n      ).then ( (response) ->\r\n        console.log \"Registration successfull \"\r\n        console.log response\r\n        window.localStorage.setItem 'user_token', response.data.token\r\n        # console.log \"user_token \" + window.localStorage.getItem 'user_token'\r\n        window.localStorage.setItem 'user_id', response.data.user.id\r\n        $state.go 'team_manager'\r\n      ), ( errResponse ) ->\r\n        console.log \"Registration failed \"\r\n        alertify.error \"Registration failed #{ JSON.stringify errResponse }\"\r\n        setTimeout ( ->\r\n          $state.go 'login' \r\n        ), 5000\r\n        console.log errResponse\r\n            \r\n       \r\n        # message.error errResponse.data.invalidAttributes.email[0].message\r\n       \r\n        \r\n])"]}