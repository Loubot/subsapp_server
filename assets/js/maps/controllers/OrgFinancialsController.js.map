{"version":3,"sources":["controllers/OrgFinancialsController.coffee"],"names":[],"mappings":"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","file":"controllers/OrgFinancialsController.js","sourceRoot":"/source/","sourcesContent":["'use strict'\r\n\r\nangular.module('subzapp').controller('OrgFinancialsController', [\r\n  '$scope'\r\n  '$rootScope'\r\n  '$state'\r\n  '$http'\r\n  'RESOURCES'\r\n  '$location'\r\n  'alertify'\r\n  'user'\r\n  'COMMS'\r\n  ( $scope, $rootScope, $state, $http, RESOURCES, $location, alertify, user, COMMS ) ->\r\n    console.log \"OrgFinancialsController\"\r\n\r\n    check_for_stripe_code = ->\r\n      if $location.search().code?\r\n        console.log $location.search().code\r\n        COMMS.POST(\r\n          \"/payment/#{ $scope.org.id }/authenticate-stripe\"\r\n          auth_code: $location.search().code\r\n        ).then ( ( res ) ->\r\n          console.log \"Authenticated stripe\"\r\n          \r\n          \r\n          message = JSON.parse res.data.body\r\n          console.log message.error_description\r\n          if message.error_description?\r\n            alertify.error message.error_description\r\n          else\r\n            alertify.success \"Authenticated stripe\"\r\n\r\n        ), ( errResponse ) ->\r\n\r\n          console.log \"Failed to authenticate stripe\"\r\n          alertify.error \"Failed to authenticate stripe\"\r\n          console.log errResponse\r\n\r\n\r\n    user.get_user().then( ( res ) ->\r\n      $scope.user = $rootScope.USER\r\n\r\n      COMMS.GET(\r\n        \"/org/#{ $scope.user.org[0].id }\"\r\n      ).then ( ( res ) ->\r\n        console.log \"Got org info\"\r\n        console.log res.data.org\r\n        $scope.org = res.data.org\r\n        alertify.success \"Got org info\"\r\n        check_for_stripe_code()\r\n      ), ( errResponse ) ->\r\n        console.log \"Get org error\"\r\n        console.log. errResponse\r\n        alertify.error \"Failed to get org info\"\r\n    ) # end of get_user\r\n\r\n    disabled = (data) ->\r\n      date = data.date\r\n      mode = data.mode\r\n      mode == 'day' and (date.getDay() == 0 or date.getDay() == 6)\r\n\r\n    getDayClass = (data) ->\r\n      date = data.date\r\n      mode = data.mode\r\n      if mode == 'day'\r\n        dayToCheck = new Date(date).setHours(0, 0, 0, 0)\r\n        i = 0\r\n        while i < $scope.events.length\r\n          currentDay = new Date($scope.events[i].date).setHours(0, 0, 0, 0)\r\n          if dayToCheck == currentDay\r\n            return $scope.events[i].status\r\n          i++\r\n      ''\r\n\r\n    $scope.today = ->\r\n      $scope.dt = new Date\r\n      return\r\n\r\n    $scope.today()\r\n\r\n    $scope.clear = ->\r\n      $scope.dt = null\r\n      return\r\n\r\n    $scope.inlineOptions =\r\n      customClass: getDayClass\r\n      minDate: new Date\r\n      showWeeks: true\r\n    $scope.dateOptions =\r\n      dateDisabled: disabled\r\n      formatYear: 'yy'\r\n      maxDate: new Date(2020, 5, 22)\r\n      minDate: new Date\r\n      startingDay: 1\r\n\r\n    $scope.toggleMin = ->\r\n      $scope.inlineOptions.minDate = if $scope.inlineOptions.minDate then null else new Date\r\n      $scope.dateOptions.minDate = $scope.inlineOptions.minDate\r\n      return\r\n\r\n    $scope.toggleMin()\r\n\r\n    $scope.open1 = ->\r\n      $scope.popup1.opened = true\r\n      return\r\n\r\n    $scope.open2 = ->\r\n      $scope.popup2.opened = true\r\n      return\r\n\r\n    $scope.setDate = (year, month, day) ->\r\n      $scope.dt = new Date(year, month, day)\r\n      return\r\n\r\n    $scope.formats = [\r\n      'dd-MMMM-yyyy'\r\n      'yyyy/MM/dd'\r\n      'dd.MM.yyyy'\r\n      'shortDate'\r\n    ]\r\n    $scope.format = $scope.formats[0]\r\n    $scope.altInputFormats = [ 'M!/d!/yyyy' ]\r\n    $scope.popup1 = opened: false\r\n    $scope.popup2 = opened: false\r\n    tomorrow = new Date\r\n    tomorrow.setDate tomorrow.getDate() + 1\r\n    afterTomorrow = new Date\r\n    afterTomorrow.setDate tomorrow.getDate() + 1\r\n    $scope.events = [\r\n      {\r\n        date: tomorrow\r\n        status: 'full'\r\n      }\r\n      {\r\n        date: afterTomorrow\r\n        status: 'partially'\r\n      }\r\n    ]\r\n\r\n\r\n])"]}